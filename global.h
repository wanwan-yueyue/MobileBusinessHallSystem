/**
 * @file global.h
 * @brief 全局变量管理头文件 - 定义系统全局变量和资源管理接口
 *        集中管理系统的全局变量，避免在多个模块中重复定义
 * 
 * 功能说明：
 * 1. 声明系统核心全局变量，包括用户数组和手机号管理器
 * 2. 提供统一的全局资源初始化和访问接口
 * 3. 确保全局变量的正确初始化和资源清理
 * 4. 支持全局资源的线程安全访问
 * 
 * 作    者：
 * 创建日期：2025-10-29
 * 版本信息：v2.0（适配模块化架构）
 * 版权声明：© 2025 | 保留所有权利
 * 
 * 实现说明：
 * 1. 使用extern关键字声明全局变量，避免重复定义
 * 2. 提供获取手机号管理器的单例接口
 * 3. 封装全局资源的初始化和清理操作
 * 
 * 依赖说明：
 * - 自定义模块：user.h、phone.h、menu.h、data.h
 * 
 * 修改记录：
 * 2025-11-1   新增文件，定义全局变量管理接口（v1.0）
 * 2025-11-1   扩展接口，支持手机号管理器单例模式（v1.1）
 * 2025-11-2   适配模块化架构，优化接口设计（v2.0）
 */

#ifndef GLOBAL_H
#define GLOBAL_H

#include "user.h"
#include "phone.h"
#include "menu.h"
#include "data.h"

// ========== 全局变量声明 ==========

/**
 * @brief 用户数据数组
 * 
 * 功能说明：
 * - 存储系统中所有用户的基本信息
 * - 最大容量由MAX_USERS宏定义控制
 * - 通过用户状态字段管理用户活跃性
 */
extern User users[MAX_USERS];

/**
 * @brief 当前活跃用户数量
 * 
 * 功能说明：
 * - 记录系统中当前活跃用户的数量
 * - 用于用户数组的边界检查和统计
 * - 在用户增删操作时自动更新
 */
extern int userCount;

/**
 * @brief 手机号管理器指针
 * 
 * 功能说明：
 * - 管理系统中所有手机号资源的分配和状态
 * - 采用动态内存管理，支持资源池自动扩容
 * - 通过单例模式确保全局唯一实例
 */
extern PhoneManager *phoneManager;

// ========== 全局资源管理函数接口 ==========

/**
 * @brief 初始化全局变量
 * @retval 无
 * 
 * 功能说明：
 * - 清空用户数组并重置用户计数
 * - 标记所有用户状态为未激活
 * - 延迟初始化手机号管理器
 * - 确保系统启动时所有全局变量处于正确状态
 */
void initGlobalVariables();

/**
 * @brief 获取手机号管理器实例
 * @retval PhoneManager* 手机号管理器指针，失败返回NULL
 * 
 * 功能说明：
 * - 实现手机号管理器的单例模式
 * - 如果管理器未初始化，自动创建新实例
 * - 确保在使用手机号功能前管理器已正确初始化
 * - 提供统一的手机号资源访问入口
 */
PhoneManager* getPhoneManager();

/**
 * @brief 清理全局资源
 * @retval 无
 * 
 * 功能说明：
 * - 释放手机号管理器占用的动态内存
 * - 重置全局变量到初始状态
 * - 在程序退出前调用，防止内存泄漏
 * - 确保系统资源的完全释放
 */
void cleanupGlobalResources();

/**
 * @brief 设置手机号管理器实例
 * @param manager 新的手机号管理器指针
 * @retval 无
 * 
 * 功能说明：
 * - 替换当前手机号管理器实例
 * - 自动清理旧的手机号管理器资源
 * - 用于测试或特殊场景下的管理器替换
 * - 确保资源管理的正确交接
 */
void setPhoneManager(PhoneManager* manager);

#endif